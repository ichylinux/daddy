#!/usr/bin/bash

function setup_dad() {
  sudo sed -i "s/\(^Defaults\s+secure_path\s+=\s+\).*/\1\/sbin:\/bin:\/usr\/sbin:\/usr\/bin:\/usr\/local\/bin/" /etc/sudoers
  sudo yum install -y wget

  if [ `which mitamae` ]; then
    echo -e "`mitamae version` found.\ndaddy is ready."
  else
    echo "install mitamae"
    mkdir -p ./tmp
    pushd tmp
      rm -f mitamae-x86_64-linux.tar.gz
      wget https://github.com/itamae-kitchen/mitamae/releases/download/v1.5.6/mitamae-x86_64-linux.tar.gz
      tar zxf mitamae-x86_64-linux.tar.gz
      sudo mv mitamae-x86_64-linux /usr/local/bin/mitamae
    popd
  fi
}

function setup_environment() {
  setup_dad
  mitamae local "itamae/environments/$1.rb"
}

case $1 in
  'env')
    setup_environment $2
    ;;
esac
